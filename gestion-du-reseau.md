# Gestion du réseau

## Nom réseau de la machine

Information présente dans un fichier maintenu par le Kernel

```
//equivalent

cat /proc/sys/kernel/hostname 
work

hostnamectl
 Static hostname: work
       Icon name: computer-convertible
         Chassis: convertible
      Machine ID: bbb005e373484ac2b6a19e2b2a57d057
         Boot ID: 6622c4ef8c2b4e1bac616f266e59038a
Operating System: Debian GNU/Linux 12 (bookworm)  
          Kernel: Linux 6.1.0-26-amd64
    Architecture: x86-64
 Hardware Vendor: ASUSTeK COMPUTER INC.
  Hardware Model: Zenbook UN5401QAB_UN5401QA
Firmware Version: UN5401QAB_UN5401QA.308

```

Modifier le nom du serveur

```
hostnamectl set-hostname twinkle

// ou modifier le fichier /etc/hostname
```

## Interfaces réseau

### Vérifier que le noyau a bien reconnu le matériel

La commande dmesg permet d'affichier les messages qui ont été reçus par le noyau pendant le boot

```
dmesg | grep Network
```

On peut aussi consulter les liens symboliques faire les fichiers référencés par le noyau :&#x20;

```
ls -l /sys/class/net
total 0
lrwxrwxrwx 1 root root 0 Nov  9 11:36 docker0 -> ../../devices/virtual/net/docker0
lrwxrwxrwx 1 root root 0 Nov  9 11:36 lo -> ../../devices/virtual/net/lo
lrwxrwxrwx 1 root root 0 Nov  9 11:36 wlp2s0 -> ../../devices/pci0000:00/0000:00:02.2/0000:02:00.0/net/wlp2s0

```

La carte "lo" loopback permet d'effectuer des communications internes.

### Configurer des cartes réseau de manière dynamique

Obtenir la configuration réseau :&#x20;

```
ip a
ip link show
```

Configurer une adresse ip sur une carte réseau (ici enp0s8)

```
ip addr add 192.168.2.24/24 enp0s8
```

Supprimer une adresse ip sur une carte réseau

```
ip addr add 192.168.2.24/24 enp0s8
```

**-> Ces attributions ne sont pas persistentes et disparaîtront lors du reboot de la machine**

### Configurer les cartes réseau de manière statique

#### Debian

Fichier de config à modifier sur Debian

```
/etc/network/interfaces
```

Ajouter une carte réseau chargée de manière automatique lors du démarrage :&#x20;

```
auto enp0s8
```

Faire en sorte que l'ip soit chargée de manière statique

```
auto enp0s8
iface enp0s8 inet static
address 192.128.0.124
netmask 255.255.255.0
```

Faire en sorte que l'ip soit  récupérée dynamiquement via dhcp

```
iface enp0s8 inet dhcp
```

Redémarrer le service en charge du réseau

```
systemctl restart networking.service
```

#### RedHat CentOS

Plusieurs Fichiers de config à modifier sur Red-Hat (CentOS) : un fichier ifcfg- pour chaque interface réseau

```
/etc/sysconfig/network-scripts/ifcfg-*
```

### Configurer les routes et passerelles

```
ip route list
default via 192.168.1.1 dev wlp2s0 proto dhcp src 192.168.1.35 metric 600 
169.254.0.0/16 dev wlp2s0 scope link metric 1000 
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown 
192.168.1.0/24 dev wlp2s0 proto kernel scope link src 192.168.1.35 metric 600 

```

La Route par défaut est le routeur 192.168.1.1 et c'est l'interface wlp2s0 qui permet de l'atteindre

Configurer la route par défaut

```
ip route del default 192.168.1.1
ip route add default 192.168.1.254 dev wlp2s0
```

Configurer une route vers un sous-réseau spécifique, ici : 192.138.1.0/24

```
ip route add 192.138.1.0/24 192.128.1.254 enp0s8
```

\-> Ces routes peuvent être spécifiés de manière persistente dans le fichier /etc/network/interfaces :&#x20;

```
auto enp0s8
iface enp0s8 inet static
address 192.128.0.124
netmask 255.255.255.0
gateaway 192.128.1.254
post-up ip route add 192.138.1.0/24 via 192.128.1.254 dev enp0s8
```

### DNS

Consulter les valeurs associés à "hosts" dans le fichier nsswitch.conf

#### En priorité, consultation du fichier /etc/hosts local

```
cat /etc/nsswitch.conf
hosts:          files myhostname mdns4_minimal [NOTFOUND=return] dns
```

\-> La valeur files signifie qu'il va d'abord consulter le fichier /etc/hosts en local

```
vi /etc/hosts
192.168.1.31 centOS168
```

#### Si la valeur n'est pas trouvée dans /etc/hosts , consultation du serveur DNS distant configuré dans /etc/resolv.conf

```
cat /etc/resolv.conf
# Generated by NetworkManager
search home
nameserver 192.168.1.1
nameserver 2a01:cb14:84:5300:9a42:65ff:fe01:4260
nameserver fe80::9a42:65ff:fe01:4260%wlp2s0

```



